// Generated by CoffeeScript 1.3.3
(function(){var e,t;e=function(){function e(e,t){t==null&&(t={}),this.fnStack={},this.opts=t,this.load(e)}return e.prototype.load=function(e){var t,n=this;return typeof e=="string"&&(t=document.getElementById(e))&&t.tagName==="IMG"&&(e=t),this._loaded=!1,(this.img=e).addEventListener("load",function(){return n._imageLoaded()})},e.prototype.isReady=function(){return this._loaded},e.prototype._imageLoaded=function(){var e,t,n,r,i,s=this;this.canvas=document.createElement("canvas"),this.canvas.width=this.width=i=this.img.width,this.canvas.height=this.height=n=this.img.height,this.ctx=this.canvas.getContext("2d"),this.ctx.drawImage(this.img,0,0,i,n),this.data=this.ctx.getImageData(0,0,i,n).data,e=document.createElement("canvas"),e.width=i=64,e.height=n=64*this.height/this.width,t=e.getContext("2d"),t.drawImage(this.img,0,0,i,n),r=t.getImageData(0,0,i,n).data,this.analyzeData(r,i*n);if(this.opts.disableMouse!==!0)return this.img.addEventListener("click",function(e){return s.imgClick(e)}),this.img.addEventListener("mousemove",function(e){return s.imgMousemove(e)})},e.prototype.analyzeData=function(e,n){var r,i,s,o,u,a,f,l,c,h,p,d,v,m=this;o=[],r=[],d=24,h=0,p=0,c=function(n){var i,s,u,a,f,l;return n*=4,i=t(e[n],e[n+1],e[n+2]).toHex(),s=color.hsva(i).toArray(),u=s[0]*100,a=parseInt(u%d,10),h+=s[1],p+=s[2],typeof r[a]=="undefined"&&(r[a]=[]),.92>(f=s[1])&&f>.08&&.92>(l=s[2])&&l>.08&&r[a].push(s),o.push(s)};for(u=v=0;0<=n?v<=n:v>=n;u=0<=n?++v:--v)c(u);this.avgSat=h/n,this.avgVal=p/n,f=r.map(function(e){return e?e.length:0}),l=function(){var e,t;return t=Math.max.apply(null,f),e=f.indexOf(t),f[e]=0,e},a=l(),s=function(e){var t,n,i,s,o;n=0,o=r[e];for(i=0,s=o.length;i<s;i++)t=o[i],n+=t[0];return n/=r[e].length,color.hsva({h:n,s:m.avgSat,v:m.avgVal})},i=s(a),this.color=i,this._loaded=!0;if(typeof this.opts.ready=="function")return this.opts.ready.call(this)},e.prototype.getSwatches=function(e,t){var n,r,i,s,o,u;t==null&&(t={});if(!this.isReady())return!1;o=(t.angle||30)/360,u=this.color.toArray()[0];if(e==="analogous")return n=this.color.toHex(),r=this.color.h(u-o).toHex(),i=this.color.h(u+o).toHex(),this.color.h(u),[n,r,i];if(e==="split-complementary")return n=this.color.toHex(),r=this.color.h(u+.5-o/2).toHex(),i=this.color.h(u+.5+o/2).toHex(),this.color.h(u),[n,r,i];if(e==="tetradic")return o=(t.angle||60)/360,n=this.color.toHex(),r=this.color.h(u+o).toHex(),i=this.color.h(u+.5).toHex(),s=this.color.h(u+.5+o).toHex(),this.color.h(u),[n,r,i,s]},e.prototype.colorFromPoint=function(e){var n,r;return n=r=(e.y*this.width+e.x)*4,this.hex="#"+t(this.rgb=[this.data[n],this.data[n+1],this.data[n+2]]).toHex()},e.prototype.imgClick=function(e){return this.trigger("click",this.hex,this.rgb)},e.prototype.imgMousemove=function(e){return this.trigger("mousemove",this.colorFromPoint(this.cursor=this._getCursor(e)),this.rgb)},e.prototype._getCursor=function(e){var t;return(t=this._offset)==null&&(this._offset=this._getOffset()),{x:e.clientX-this._offset.x,y:e.clientY-this._offset.y}},e.prototype._getOffset=function(){var e,t,n;t=n=0,e=this.img;while(e.offsetParent)t+=e.offsetLeft,n+=e.offsetTop,e=e.offsetParent;return this._offset={x:t,y:n}},e.prototype.trigger=function(e){var t,n,r,i,s,o;n=this.fnStack[e],t=Array.prototype.slice.call(arguments,1);if(n!=null){o=[];for(i=0,s=n.length;i<s;i++)r=n[i],o.push(r.apply(this,t));return o}},e.prototype.on=function(e,t){var n;return(this.fnStack[e]=(n=this.fnStack[e])!=null?n:[]).push(t)},e.prototype.off=function(e,t){var n,r,i,s,o,u;n=this.fnStack[e];if(typeof t=="function"?t():void 0){u=[];for(i=s=0,o=n.length;s<o;i=++s)r=n[i],u.push(r===t?n.splice(i,1):void 0);return u}return delete this.fnStack[e]},e}(),t=function(e){return arguments.length>1&&(e=[arguments[0],arguments[1],arguments[2]]),color.rgba({r:e[0]/255,g:e[1]/255,b:e[2]/255})},window.ImageEyeDropper=e}).call(this);